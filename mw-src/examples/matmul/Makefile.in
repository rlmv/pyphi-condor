#-------------------------------------------------------------------------
# This file was automatically generated by Automake, and manually modified 
# to make it simpler and cleaner. There are three sections in the file:
# 1) Macros
# 2) Recursive Rules and Suffixes (implicit rules)
# 3) Explicit Rules
#-------------------------------------------------------------------------

#-------------------------------------------------------------------------
#   Section 1) Macros
#-------------------------------------------------------------------------
top_srcdir = @top_srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@
includedir = @includedir@

CONDOR_DIR = @CONDOR_DIR@
CXX = @CXX@
MEASURE_DEFN = @MEASURE_DEFN@
MISC_DEFN = @MISC_DEFN@
MISC_LIB = @MISC_LIB@
MW_LIBDIR = @MW_LIBDIR@
MW_LIBDIR_DEBUG = @MW_LIBDIR_DEBUG@
PVM_ROOT = @PVM_ROOT@
PVM_ARCH = @PVM_ARCH@
RANLIB = @RANLIB@
INSTALL = @INSTALL@
SOCKET_LIB = @SOCKET_LIB@
PACKAGE = @PACKAGE@
VERSION = @VERSION@
USE_CHIRP = @USE_CHIRP@
USE_MWFILE = @USE_MWFILE@

mkinstalldirs = $(SHELL) $(top_srcdir)/mkinstalldirs
AR = ar

DEFS = @DEFS@ -I.
LIBS = @LIBS@
CPPFLAGS = @CPPFLAGS@
LDFLAGS = @LDFLAGS@
CXXFLAGS = @CXXFLAGS@ -Wall

# Subdirectories
SUBDIRS =

ENABLE_MWINDEPENDENT = @ENABLE_MWINDEPENDENT@
ifeq ($(ENABLE_MWINDEPENDENT), yes)
INDEPENDENT_PROGS = mastermatmul_indp 
INDEPENDENT_INCLS = ../../src/RMComm/MW-Independent
mastermatmul_indp_LDADD = -L$(MW_LIBDIR) -lMW_indp -lMWRMComm_indp -lMWRC_indp -lMWutil_indp  $(SOCKET_LIB) $(MISC_LIB)
mastermatmul_indp_OBJECTS =  Driver-Matmul-Ind.o Worker-Matmul-Ind.o Task-Matmul-Ind.o MasterMain-Matmul-Ind.o
endif

# Check programs to be built, and dependent source files
ifdef DEBUG_BUILD
  # To work with Insure, need to "setenv DEBUG_BUILD='insure'" and write/copy a good .psrc file
DEBUG_CHECKER = $(DEBUG_BUILD)
MW_LIBDIR = $(MW_LIBDIR_DEBUG)
  # MW-File doesn't work with Insure, so will not compile *_file if DEBUG_BUILD
PROGRAMS = mastermatmul_socket workermatmul_socket $(INDEPENDENT_PROGS)
INCLUDES = -I../../src -I../../src/MWControlTasks -I../../src/RMComm -I../../src/RMComm/MW-CondorPVM -I$(INDEPENDENT_INCLS) $(MEASURE_DEFN)
else 
PROGRAMS = mastermatmul_socket workermatmul_socket $(INDEPENDENT_PROGS)
INCLUDES = -I../../src -I../../src/MWControlTasks -I../../src/RMComm -I../../src/RMComm/MW-File -I../../src/RMComm/MW-CondorPVM -I$(INDEPENDENT_INCLS) $(MEASURE_DEFN)
endif

# Only build Independent if no condor
ifeq ($(CONDOR_DIR), no)
PROGRAMS = $(INDEPENDENT_PROGS)
else

# If Condor, and PVM_ROOT is valid, also build condorpvm variants
ifneq ($(PVM_ROOT), no)
PROGRAMS += mastermatmul_condorpvm workermatmul_condorpvm
endif

# if USE_MWFILE != no, also build mwfile
ifneq ($(USE_MWFILE), no)
PROGRAMS += mastermatmul_file workermatmul_file
endif

endif

ifdef USE_CHIRP
CONDOR_COMPILE = 
else
CONDOR_COMPILE = $(CONDOR_DIR)/bin/condor_compile
endif

CXXCOMPILE = $(DEBUG_CHECKER) $(CXX) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
CXXLD = $(DEBUG_CHECKER) $(CXX)
CXXLINK = $(CXXLD) $(AM_CXXFLAGS) $(CXXFLAGS) $(LDFLAGS) -o $@

mastermatmul_file_SOURCES = Driver-Matmul.C Task-Matmul.C MasterMain-Matmul.C
mastermatmul_file_LDADD = -L$(MW_LIBDIR) -lMW -lMWRMComm -lMWfilemaster -lMWutil $(CONDOR_DIR)/lib/libcondorapi.a  $(SOCKET_LIB) $(MISC_LIB) -ldl
mastermatmul_file_OBJECTS =  Driver-Matmul.o Task-Matmul.o MasterMain-Matmul.o
mastermatmul_file_DEPENDENCIES =  $(CONDOR_DIR)/lib/libcondorapi.a 
mastermatmul_file_LDFLAGS = 
workermatmul_file_SOURCES = Worker-Matmul.C Task-Matmul.C WorkerMain-Matmul.C
workermatmul_file_LDADD = -L$(MW_LIBDIR) -lMW -lMWRMComm -lMWfileworker -lMWutil -lMW -lMWRMComm  $(SOCKET_LIB) $(MISC_LIB)
workermatmul_file_OBJECTS =  Worker-Matmul.o Task-Matmul.o WorkerMain-Matmul.o
workermatmul_file_DEPENDENCIES =
workermatmul_file_LDFLAGS =

mastermatmul_condorpvm_SOURCES = Driver-Matmul.C Task-Matmul.C MasterMain-Matmul.C
mastermatmul_condorpvm_LDADD = -L$(MW_LIBDIR) -lMW -lMWRMComm -lMWcondorpvmmaster -lMWutil -L$(PVM_ROOT)/lib/$(PVM_ARCH) -lpvm3  $(SOCKET_LIB) $(MISC_LIB)
mastermatmul_condorpvm_OBJECTS =  Driver-Matmul.o Task-Matmul.o MasterMain-Matmul.o
mastermatmul_condorpvm_DEPENDENCIES =
mastermatmul_condorpvm_LDFLAGS =
workermatmul_condorpvm_SOURCES = Worker-Matmul.C Task-Matmul.C WorkerMain-Matmul.C
workermatmul_condorpvm_LDADD = -L$(MW_LIBDIR) -lMW -lMWRMComm -lMWcondorpvmworker -lMWutil -lNWS -lMW -lMWRMComm -L$(PVM_ROOT)/lib/$(PVM_ARCH) -lpvm3  -lMW -lMWRMComm  $(SOCKET_LIB) $(MISC_LIB)
workermatmul_condorpvm_OBJECTS =  Worker-Matmul.o Task-Matmul.o WorkerMain-Matmul.o
workermatmul_condorpvm_DEPENDENCIES =
workermatmul_condorpvm_LDFLAGS =

mastermatmul_socket_SOURCES = Driver-Matmul.C Task-Matmul.C MasterMain-Matmul.C
mastermatmul_socket_LDADD = -L$(MW_LIBDIR) -lMW -lMWRMComm -lMWsocketmaster -lMWutil  $(SOCKET_LIB) $(MISC_LIB)
mastermatmul_socket_OBJECTS =  Driver-Matmul.o Task-Matmul.o MasterMain-Matmul.o
mastermatmul_socket_DEPENDENCIES =
mastermatmul_socket_LDFLAGS =
workermatmul_socket_SOURCES = Worker-Matmul.C Task-Matmul.C WorkerMain-Matmul.C
workermatmul_socket_LDADD = -L$(MW_LIBDIR) -lMW -lMWRMComm -lMWsocketworker -lNWS -lMWutil -lMW -lMWRMComm  $(SOCKET_LIB) $(MISC_LIB)
workermatmul_socket_OBJECTS =  Worker-Matmul.o Task-Matmul.o WorkerMain-Matmul.o
workermatmul_socket_DEPENDENCIES =
workermatmul_socket_LDFLAGS =

#-------------------------------------------------------------------------
#   Section 2) Explicit and Implicit Rules
#-------------------------------------------------------------------------

# make the independent, pvm, socket and file version (file should compile out of the box now)

all: $(PROGRAMS)

Driver-Matmul-Ind.o:Driver-Matmul.C
	$(CXXCOMPILE) -DINDEPENDENT -o Driver-Matmul-Ind.o -c Driver-Matmul.C
Task-Matmul-Ind.o:Task-Matmul.C
	$(CXXCOMPILE) -DINDEPENDENT -o Task-Matmul-Ind.o -c Task-Matmul.C
Worker-Matmul-Ind.o:Worker-Matmul.C
	$(CXXCOMPILE) -DINDEPENDENT -o Worker-Matmul-Ind.o -c Worker-Matmul.C
MasterMain-Matmul-Ind.o:MasterMain-Matmul.C
	$(CXXCOMPILE) -DINDEPENDENT -o MasterMain-Matmul-Ind.o -c MasterMain-Matmul.C

mastermatmul_indp: $(mastermatmul_indp_OBJECTS)
	@rm -f mastermatmul_indp
	$(CXXLINK) $(mastermatmul_indp_LDFLAGS) $(mastermatmul_indp_OBJECTS) $(mastermatmul_indp_LDADD) $(LIBS)

mastermatmul_file: $(mastermatmul_file_OBJECTS) $(mastermatmul_file_DEPENDENCIES)
	@rm -f mastermatmul_file
	$(CXXLINK) $(mastermatmul_file_LDFLAGS) $(mastermatmul_file_OBJECTS) $(mastermatmul_file_LDADD) $(LIBS)

workermatmul_file: $(workermatmul_file_OBJECTS) 
	$(CONDOR_COMPILE) $(CXXLINK) $(workermatmul_file_LDFLAGS) $(workermatmul_file_OBJECTS) $(workermatmul_file_LDADD) $(LIBS) $(INCLUDES)

mastermatmul_condorpvm: $(mastermatmul_condorpvm_OBJECTS) $(mastermatmul_condorpvm_DEPENDENCIES)
	@rm -f mastermatmul_condorpvm
	$(CXXLINK) $(mastermatmul_condorpvm_LDFLAGS) $(mastermatmul_condorpvm_OBJECTS) $(mastermatmul_condorpvm_LDADD) $(LIBS)

workermatmul_condorpvm: $(workermatmul_condorpvm_OBJECTS) $(workermatmul_condorpvm_DEPENDENCIES)
	@rm -f workermatmul_condorpvm
	$(CXXLINK) $(workermatmul_condorpvm_LDFLAGS) $(workermatmul_condorpvm_OBJECTS) $(workermatmul_condorpvm_LDADD) $(LIBS)

mastermatmul_socket: $(mastermatmul_socket_OBJECTS) $(mastermatmul_socket_DEPENDENCIES)
	@rm -f mastermatmul_socket
	$(CXXLINK) $(mastermatmul_socket_LDFLAGS) $(mastermatmul_socket_OBJECTS) $(mastermatmul_socket_LDADD) $(LIBS)

workermatmul_socket: $(workermatmul_socket_OBJECTS) $(workermatmul_socket_DEPENDENCIES)
	@rm -f workermatmul_socket
	$(CXXLINK) $(workermatmul_socket_LDFLAGS) $(workermatmul_socket_OBJECTS) $(workermatmul_socket_LDADD) $(LIBS)

.SUFFIXES: .C .o

.C.o:
	$(CXXCOMPILE) -c $<

#-------------------------------------------------------------------------
#   Section 3) Recursive Rules: Common
#-------------------------------------------------------------------------
install:

check: $(PROGRAMS)
	[ "__$(SUBDIRS)" = "__" ] || for subdir in `echo "$(SUBDIRS)"`; do (cd $$subdir && $(MAKE) $@) ; done

clean:
	-rm -f $(PROGRAMS) *.o *.a core
	[ "__$(SUBDIRS)" = "__" ] || for subdir in `echo "$(SUBDIRS)"`; do (cd $$subdir && $(MAKE) $@) ; done

distclean:
	-rm -f Makefile *.tar *.gz
	-rm -rf .deps
	-rm -f config.cache config.log stamp-h stamp-h[0-9]*
	-rm -f $(PROGRAMS) *.o *.a core
	[ "__$(SUBDIRS)" = "__" ] || for subdir in `echo "$(SUBDIRS)"`; do (cd $$subdir && $(MAKE) $@) ; done

.PHONY: all check clean distclean install
